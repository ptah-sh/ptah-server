<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Team;
use Inertia\Inertia;

class TeamController extends Controller
{
    public function index()
    {
        $teams = Team::withCount('nodes', 'services', 'onlineNodes', 'deployments')->paginate(30);

        $teams->load('owner');

        return Inertia::render('Admin/Teams/List', [
            'teams' => $teams,
        ]);
    }

    public function show(Team $team)
    {
        $team->load('owner');
        $quotas = $team->quotas();
        $plan = $team->currentPlan();

        $quotaTypes = array_keys($plan->quotas);
        $quotasArray = [];

        foreach ($quotaTypes as $type) {
            $quotasArray[$type] = [
                'maxUsage' => $quotas->$type->maxUsage,
                'currentUsage' => $quotas->$type->currentUsage(),
                'isSoft' => $plan->quotas[$type]['soft'],
            ];
        }

        return Inertia::render('Admin/Teams/Edit', [
            'team' => $team,
            'quotas' => $quotasArray,
        ]);
    }
}
